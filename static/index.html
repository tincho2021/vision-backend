<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Behavior-Action Vision</title>
<style>
body {
  background: #0f0f0f;
  color: white;
  font-family: Arial;
  text-align: center;
}
button {
  padding: 10px 15px;
  margin: 5px;
}
input[type=range] {
  width: 300px;
}
pre {
  background: #1e1e1e;
  padding: 15px;
  text-align: left;
  display: inline-block;
}
</style>
</head>

<body>

<h1>ğŸ§  Behavior-Action Vision</h1>

<input type="file" id="fileInput"><br><br>

<button onclick="setReference()">ğŸ“Œ Setear referencia</button>
<button onclick="analyze()">ğŸ” Analizar comportamiento</button>

<br><br>

<h3>Sensibilidad de detecciÃ³n</h3>
<input type="range" id="threshold" min="0.01" max="0.5" step="0.01" value="0.25"
       oninput="updateThresholdLabel()">
<br>
<span id="thresholdLabel">Threshold: 0.25</span>

<br><br>

<img id="preview" width="400"><br><br>

<h2>Resultado</h2>
<pre id="result"></pre>

<script>
let base64Image = null;

document.getElementById("fileInput").addEventListener("change", e => {
  const reader = new FileReader();
  reader.onload = () => {
    base64Image = reader.result;
    document.getElementById("preview").src = base64Image;
  };
  reader.readAsDataURL(e.target.files[0]);
});

function updateThresholdLabel() {
  const v = document.getElementById("threshold").value;
  document.getElementById("thresholdLabel").innerText = `Threshold: ${v}`;
}

function setReference() {
  fetch("/set_reference", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ image: base64Image })
  })
  .then(r => r.json())
  .then(j => document.getElementById("result").innerText = JSON.stringify(j, null, 2));
}

function analyze() {
  if (!base64Image) {
    alert("Primero seleccionÃ¡ una imagen");
    return;
  }

  const threshold = document.getElementById("threshold").value;

  fetch("/analyze", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      image: base64Image,
      threshold: threshold
    })
  })
  .then(r => r.json())
  .then(j => {
    document.getElementById("result").innerText =
      JSON.stringify(j, null, 2);
  })
  .catch(err => {
    document.getElementById("result").innerText =
      "Error: " + err;
  });
}

</script>

</body>
</html>
