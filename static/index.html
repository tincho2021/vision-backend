<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Behavior-Action Vision</title>
  <style>
    body {
      background: #0e0e0e;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    img {
      max-width: 500px;
      margin-top: 15px;
      border-radius: 6px;
    }
    button {
      margin: 10px;
      padding: 10px 16px;
      font-size: 14px;
      cursor: pointer;
    }
    .result {
      background: #111;
      margin: 20px auto;
      padding: 15px;
      width: 70%;
      text-align: left;
      border-radius: 6px;
      font-family: monospace;
    }
  </style>
</head>
<body>

<h1>üß† Behavior-Action Vision</h1>

<input type="file" id="fileInput" accept="image/*"><br>

<button onclick="setReference()">üìå Setear referencia</button>
<button onclick="analyze()">üîç Analizar comportamiento</button>

<h3>Sensibilidad de detecci√≥n</h3>
<input type="range" id="threshold" min="0.05" max="0.6" step="0.01" value="0.25"
       oninput="document.getElementById('tval').innerText=this.value">
<br>
Threshold: <span id="tval">0.25</span>

<div>
  <img id="preview">
</div>

<h2>Resultado</h2>
<pre class="result" id="result"></pre>

<script>
let base64Image = null;

document.getElementById("fileInput").addEventListener("change", e => {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = () => {
    base64Image = reader.result.split(",")[1];
    document.getElementById("preview").src = reader.result;
  };
  reader.readAsDataURL(file);
});

async function setReference() {
  if (!base64Image) {
    alert("Seleccion√° una imagen primero");
    return;
  }

  const res = await fetch("/reference", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ image: base64Image })
  });

  const json = await res.json();
  document.getElementById("result").innerText = JSON.stringify(json, null, 2);
}

async function analyze() {
  if (!base64Image) {
    alert("Seleccion√° una imagen primero");
    return;
  }

  const threshold = document.getElementById("threshold").value;

  const res = await fetch("/analyze", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      image: base64Image,
      threshold: threshold
    })
  });

  const json = await res.json();
  document.getElementById("result").innerText = JSON.stringify(json, null, 2);
}
</script>

</body>
</html>
