<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Behavior-Action Vision</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    text-align: center;
    padding: 30px;
}
button {
    padding: 10px 20px;
    margin: 10px;
    font-size: 16px;
    cursor: pointer;
}
input {
    margin: 10px;
}
img {
    max-width: 400px;
    margin-top: 20px;
    border: 2px solid #444;
}
pre {
    background: #222;
    padding: 15px;
    max-width: 700px;
    margin: 20px auto;
    overflow-x: auto;
    text-align: left;
}
.status-stable { color: #00ff88; }
.status-changed { color: #ff4444; }
.status-unknown { color: #ffaa00; }
</style>
</head>

<body>

<h1>üß† Behavior-Action Vision</h1>

<input type="file" id="imageInput" accept="image/*"><br>

<button onclick="setReference()">üìå Setear referencia</button>
<button onclick="analyze()">üîç Analizar comportamiento</button>

<div>
    <img id="preview">
</div>

<h3>Resultado</h3>
<pre id="output">Sin datos</pre>

<script>
async function sendImage(endpoint) {
    const fileInput = document.querySelector('input[type="file"]');
    const resultBox = document.getElementById("result");

    if (!fileInput.files.length) {
        resultBox.innerText = "‚ùå No image selected";
        return;
    }

    const formData = new FormData();
    formData.append("image", fileInput.files[0]);

    resultBox.innerText = "‚è≥ Procesando...";

    try {
        const response = await fetch(endpoint, {
            method: "POST",
            body: formData
        });

        const contentType = response.headers.get("content-type") || "";

        // üîê PROTECCI√ìN CLAVE
        if (!contentType.includes("application/json")) {
            const text = await response.text();
            resultBox.innerText =
                "‚ùå Backend devolvi√≥ HTML (ruta incorrecta)\n\n" +
                text.slice(0, 300);
            return;
        }

        const data = await response.json();
        resultBox.innerText = JSON.stringify(data, null, 2);

    } catch (err) {
        resultBox.innerText = "‚ùå Error JS: " + err.message;
    }
}

function analyze() {
    sendImage("/analyze");
}

function setReference() {
    sendImage("/reference");
}

function analyzeBehavior() {
    sendImage("/behavior");
}
</script>


</body>
</html>
